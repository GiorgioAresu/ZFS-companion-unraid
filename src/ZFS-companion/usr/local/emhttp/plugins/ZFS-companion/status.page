Menu="Dashboard"
Tag="database"
Cond="file_exists('/usr/sbin/zpool')"
---
<style type="text/css">
  .zfs_view {
    display: none
  }
</style>

<table id="zfs_view" class="dash_zfscompanion dashboard box1">
  <thead sort='<?=++$N?>' class="sortable">
    <tr class='hidden'>
      <td></td>
      <td colspan='3'></td>
      <td></td>
    </tr>
  </thead>
  <tbody sort='<?=$N?>' class='sortable'>
    <tr>
      <td></td>
      <td colspan='3' class='next'><i class='icon-zfs'></i>
        <div class='section'>_(ZFS)_<br>
          <span>_(Healthy)_: <span id='zfscompanion-healthy'></span></span><br><br>
        </div>
        <i class='fa fa-fw chevron' id='zfs_view' onclick='toggleChevron("zfs_view",0)'></i>
        <a href='/Dashboard/Settings/ZFSsettings' title="_(Go to ZFS settings)_"><i
            class='fa fa-fw fa-cog chevron'></i></a>
      </td>
      <td></td>
    </tr>
    <tr class='zfs_view'>
      <td></td>
      <td colspan='3'>
        <span class='ups'>_(Pool)_:</span><span id='zfscompanion-name'></span><br>
        <span class='ups'>_(Status)_:</span><span id='zfscompanion-status'></span><br>
      </td>
      <td></td>
    </tr>
  </tbody>
</table>

<script>
  const zfscompanion_status = () => {
    $.getJSON("/plugins/ZFS-companion/status.php", (data) => {
      if(data) {
        $.each(data, function (key, data) {
          $("#zfscompanion-"+key).html(data);
          })
        $("#zfscompanion-"+name).html(data.pools[0].name);
      }
      <?if ($update):?>
        setTimeout(zfscompanion_status, <?=max(abs($display["refresh"]),5000)?>);
      <?endif;?>
    });
  };
  $(zfscompanion_status);

  $(function() {
    // append data from the table into the correct one
    $("#zfs_view").append($(".dash_zfscompanion").html());
    
    // reload toggle to get the correct state
    toggleView('dash_zfscompanion_toggle',true);
    
    // reload sorting to get the stored data (cookie)
    sortTable($('#zfs_view'),$.cookie('zfs_view'));
  });
</script>
