Menu="Dashboard"
Cond="file_exists('/usr/sbin/zpool')"
---
<style type="text/css">
#  .dash_zfscompanion_toggle {display:none;}	
#  .dash_zfscompanion_header {padding-top: 20px}	
  .dash_zfscompanion_section {
    line-height:1.4em !important;
    margin-left:-4px !important;
  }
</style>

<table id="db-box1" class="dash_zfscompanion dashboard box1" style="display:none">
  <thead sort="965" class="sortable">
    <tr>
      <td></td>
      <td class="next dash_zfscompanion_header" colspan="3">
        <i class="icon-ups"></i>
        <div class="section dash_zfscompanion_section">
          ZFS
          <br>
          <span>Healthy: <span id="zfscompanion-healthy"></span></span>
        </div>
      </td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Pool: <span id="zfscompanion-pool"></span> (<span id="zfscompanion-name"></span>)</td>
    </tr>
    <tr>
      <br>
      <td>State: <span id="zfscompanion-state"></span></td>
    </tr>
    <tr>
      <br>
      <td>Errors <span id="zfscompanion-errors"></span></td>
    </tr>
    <tr>
      <br>
      <td>Scan: <span id="zfscompanion-scan"></span></td>
    </tr>
  </tbody>
</table>

<script>
  const zfscompanion_status = () => {
    $.getJSON("/plugins/ZFS-companion/status.php", (data) => {
      if(data) {
        $.each(data, function (key, data) {
          $("#zfscompanion-"+key).html(data);
        })
        $("#zfscompanion-name").html(data.pools[0].name);
      }
      <?if ($update):?>
        setTimeout(zfscompanion_status, <?=max(abs($display["refresh"]),2000)?>);
      <?endif;?>
    });
  };
  $(zfscompanion_status);

  $(function() {
    // append data from the table into the correct one
    $("#db-box1").append($(".dash_zfscompanion").html());
    
    // reload toggle to get the correct state
    toggleView('dash_zfscompanion_toggle',true);
    
    // reload sorting to get the stored data (cookie)
    sortTable($('#db-box1'),$.cookie('db-box1'));
  });
</script>